<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Screen Color Fill</title>
  <style>
    :root {
      color-scheme: dark;
      --ui-ink: rgba(243, 249, 255, 0.94);
      --ui-muted: rgba(218, 233, 247, 0.72);
      --ui-hairline: rgba(255, 255, 255, 0.24);
      --ui-glass-a: rgba(226, 236, 236, 0.27);
      --ui-glass-b: rgba(132, 147, 152, 0.21);
      --ui-shadow: rgba(0, 0, 0, 0.34);
      --ui-ring: rgba(131, 206, 255, 0.92);
      --form-bg: rgba(20, 28, 36, 0.44);
      --form-border: rgba(255, 255, 255, 0.16);
      --form-inset: rgba(255, 255, 255, 0.18);
      --input-bg: rgba(16, 23, 31, 0.52);
      --input-border: rgba(255, 255, 255, 0.16);
      --input-text: rgba(248, 252, 255, 0.95);
      --input-placeholder: rgba(223, 238, 250, 0.58);
      --custom-preview: linear-gradient(150deg, #8b5cf6, #3b82f6 50%, #22d3ee);
      --assist-fg: rgba(237, 240, 246, 0.98);
      --assist-muted: rgba(223, 227, 236, 0.9);
      --assist-bg: rgba(35, 37, 43, 0.9);
      --assist-bg-strong: rgba(28, 31, 38, 0.94);
      --assist-border: rgba(132, 137, 149, 0.45);
      --assist-card-bg: rgba(35, 37, 43, 0.76);
      --assist-card-border: rgba(132, 137, 149, 0.33);
      --assist-ghost-border: rgba(132, 137, 149, 0.23);
      --assist-row-bg: rgba(42, 45, 53, 0.92);
      --assist-row-border: rgba(113, 118, 130, 0.48);
      --assist-key-bg: rgba(29, 32, 39, 0.96);
      --assist-key-border: rgba(120, 126, 139, 0.62);
      --assist-shadow: rgba(0, 0, 0, 0.5);
    }

    body.ui-light {
      --ui-ink: rgba(16, 22, 30, 0.9);
      --ui-muted: rgba(22, 30, 39, 0.68);
      --ui-hairline: rgba(18, 22, 28, 0.2);
      --ui-glass-a: rgba(255, 255, 255, 0.37);
      --ui-glass-b: rgba(222, 228, 234, 0.3);
      --ui-shadow: rgba(0, 0, 0, 0.22);
      --ui-ring: rgba(38, 93, 180, 0.88);
      --form-bg: rgba(246, 250, 255, 0.56);
      --form-border: rgba(18, 22, 28, 0.16);
      --form-inset: rgba(255, 255, 255, 0.26);
      --input-bg: rgba(255, 255, 255, 0.67);
      --input-border: rgba(18, 22, 28, 0.16);
      --input-text: rgba(18, 23, 30, 0.95);
      --input-placeholder: rgba(34, 41, 52, 0.54);
      --assist-fg: rgba(237, 240, 246, 0.98);
      --assist-muted: rgba(223, 227, 236, 0.9);
      --assist-bg: rgba(35, 37, 43, 0.92);
      --assist-bg-strong: rgba(28, 31, 38, 0.96);
      --assist-border: rgba(132, 137, 149, 0.5);
      --assist-card-bg: rgba(35, 37, 43, 0.8);
      --assist-card-border: rgba(132, 137, 149, 0.36);
      --assist-ghost-border: rgba(132, 137, 149, 0.26);
      --assist-row-bg: rgba(42, 45, 53, 0.94);
      --assist-row-border: rgba(113, 118, 130, 0.52);
      --assist-key-bg: rgba(29, 32, 39, 0.98);
      --assist-key-border: rgba(120, 126, 139, 0.65);
      --assist-shadow: rgba(0, 0, 0, 0.52);
    }

    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      overflow: hidden;
    }

    body {
      min-height: 100vh;
      min-height: 100dvh;
      background: black;
      transition: background-color 170ms linear;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    #controls {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: end center;
      padding: clamp(14px, 4vh, 38px);
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition:
        opacity 720ms cubic-bezier(0.22, 1, 0.36, 1),
        visibility 0s linear 720ms;
      z-index: 10;
    }

    #controls.visible {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transition:
        opacity 460ms cubic-bezier(0.22, 1, 0.36, 1),
        visibility 0s linear 0s;
    }

    .dock-wrap {
      display: grid;
      justify-items: center;
      gap: 12px;
      transform: translateY(20px) scale(0.97);
      filter: blur(10px);
      transition:
        transform 560ms cubic-bezier(0.22, 1, 0.36, 1),
        filter 560ms cubic-bezier(0.22, 1, 0.36, 1);
    }

    #controls.visible .dock-wrap {
      transform: translateY(0) scale(1);
      filter: blur(0);
    }

    .dock {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 999px;
      background: linear-gradient(128deg, var(--ui-glass-a), var(--ui-glass-b));
      border: 1px solid var(--ui-hairline);
      box-shadow:
        0 20px 42px var(--ui-shadow),
        inset 0 1px 0 rgba(255, 255, 255, 0.36);
      backdrop-filter: blur(22px) saturate(170%);
      -webkit-backdrop-filter: blur(22px) saturate(170%);
    }

    .swatch {
      position: relative;
      width: 64px;
      height: 64px;
      border: 1px solid rgba(255, 255, 255, 0.26);
      border-radius: 20px;
      padding: 0;
      cursor: pointer;
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.22),
        inset 0 -14px 24px rgba(0, 0, 0, 0.24),
        0 9px 16px rgba(0, 0, 0, 0.26);
      transition:
        transform 320ms cubic-bezier(0.22, 1, 0.36, 1),
        box-shadow 320ms cubic-bezier(0.22, 1, 0.36, 1),
        border-color 320ms ease;
    }

    .swatch::after {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.23), rgba(255, 255, 255, 0) 48%);
      pointer-events: none;
    }

    .swatch.is-active {
      border-color: var(--ui-ring);
      box-shadow:
        0 0 0 2px var(--ui-ring),
        inset 0 1px 0 rgba(255, 255, 255, 0.22),
        inset 0 -10px 20px rgba(0, 0, 0, 0.18),
        0 12px 24px rgba(0, 0, 0, 0.34);
    }

    .swatch-black {
      background: linear-gradient(150deg, #292929, #080808 58%, #000000);
    }

    .swatch-white {
      background: linear-gradient(150deg, #ffffff, #ececec 58%, #d7d7d7);
    }

    .swatch-red {
      background: linear-gradient(150deg, #ff6d6d, #dc1f1f 58%, #8f0a0a);
    }

    .swatch-custom {
      background: var(--custom-preview);
      color: var(--ui-ink);
      font-size: 35px;
      line-height: 1;
      font-weight: 300;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.35);
    }

    .swatch-custom span {
      display: inline-block;
      transform: translateY(-2px);
    }

    .swatch:focus-visible,
    .custom-form input:focus-visible,
    .apply-btn:focus-visible,
    .help-ghost:focus-visible,
    .shortcut-action:focus-visible {
      outline: 2px solid var(--ui-ring);
      outline-offset: 3px;
      box-shadow: 0 0 0 5px rgba(8, 12, 20, 0.52);
    }

    .custom-form {
      width: min(92vw, 560px);
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 10px;
      padding: 9px;
      border-radius: 16px;
      background: var(--form-bg);
      border: 1px solid var(--form-border);
      box-shadow:
        0 12px 24px rgba(0, 0, 0, 0.26),
        inset 0 1px 0 var(--form-inset);
      backdrop-filter: blur(10px) saturate(125%);
      -webkit-backdrop-filter: blur(10px) saturate(125%);
      opacity: 0;
      transform: translateY(-10px) scale(0.98);
      pointer-events: none;
      visibility: hidden;
      transition:
        opacity 320ms ease,
        transform 320ms cubic-bezier(0.22, 1, 0.36, 1),
        visibility 0s linear 320ms;
    }

    .custom-form.open {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
      visibility: visible;
      transition:
        opacity 320ms ease,
        transform 320ms cubic-bezier(0.22, 1, 0.36, 1),
        visibility 0s linear 0s;
    }

    .color-dot {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid var(--ui-hairline);
      background: black;
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.25),
        0 2px 7px rgba(0, 0, 0, 0.35);
    }

    .custom-form input,
    .apply-btn {
      border: 0;
      border-radius: 12px;
      box-sizing: border-box;
      outline: none;
    }

    .custom-form input {
      min-width: 0;
      padding: 11px 13px;
      font-size: 14px;
      letter-spacing: 0.01em;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      color: var(--input-text);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.14);
    }

    .custom-form input::placeholder {
      color: var(--input-placeholder);
    }

    .apply-btn {
      width: 44px;
      height: 44px;
      display: grid;
      place-items: center;
      cursor: pointer;
      color: var(--ui-ink);
      font-size: 18px;
      line-height: 1;
      background: linear-gradient(145deg, rgba(57, 109, 248, 0.8), rgba(37, 77, 176, 0.86));
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 6px 12px rgba(8, 18, 54, 0.25);
    }

    #error {
      min-height: 16px;
      font-size: 12px;
      line-height: 1.2;
      color: rgba(255, 212, 212, 0.95);
      letter-spacing: 0.01em;
      text-align: center;
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.35);
      opacity: 0;
      transition: opacity 160ms ease;
    }

    #error.visible {
      opacity: 1;
    }

    .help-ghost {
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 22;
      width: 38px;
      height: 38px;
      padding: 0;
      border: 1px solid var(--assist-ghost-border);
      border-radius: 999px;
      background:
        linear-gradient(130deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.03)),
        var(--assist-bg-strong);
      color: var(--assist-muted);
      font-size: 18px;
      line-height: 1;
      cursor: pointer;
      opacity: 0.66;
      backdrop-filter: blur(12px) saturate(150%);
      -webkit-backdrop-filter: blur(12px) saturate(150%);
      box-shadow:
        0 8px 20px var(--assist-shadow),
        inset 0 1px 0 rgba(255, 255, 255, 0.18);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.45);
      transition:
        opacity 220ms ease,
        transform 220ms ease,
        color 220ms ease;
    }

    .help-ghost.active {
      opacity: 0.86;
      color: var(--assist-fg);
    }

    .help-card {
      position: fixed;
      right: 14px;
      bottom: 56px;
      z-index: 21;
      width: min(92vw, 244px);
      padding: 16px 16px 14px;
      border-radius: 18px;
      border: 1px solid var(--assist-card-border);
      background: var(--assist-card-bg);
      box-shadow:
        0 16px 30px var(--assist-shadow),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(18px) saturate(145%);
      -webkit-backdrop-filter: blur(18px) saturate(145%);
      color: var(--assist-fg);
      opacity: 0;
      transform: translateY(8px) scale(0.98);
      visibility: hidden;
      pointer-events: none;
      transition:
        opacity 280ms ease,
        transform 280ms cubic-bezier(0.22, 1, 0.36, 1),
        visibility 0s linear 280ms;
    }

    .help-card.open {
      opacity: 1;
      transform: translateY(0) scale(1);
      visibility: visible;
      pointer-events: auto;
      transition:
        opacity 280ms ease,
        transform 280ms cubic-bezier(0.22, 1, 0.36, 1),
        visibility 0s linear 0s;
    }

    .keys {
      display: grid;
      grid-template-columns: 1fr;
      gap: 9px;
    }

    .help-credit {
      margin-top: 12px;
      text-align: center;
      font-size: 11px;
      color: var(--assist-muted);
      opacity: 0.68;
      letter-spacing: 0.01em;
    }

    .help-credit a {
      color: inherit;
      text-decoration: none;
      opacity: 0.82;
      transition: opacity 180ms ease;
    }

    .help-credit a:hover {
      opacity: 0.96;
    }

    .shortcut {
      width: 94%;
      min-height: 46px;
      padding: 8px 9px 8px 14px;
      border-radius: 12px;
      border: 1px solid var(--assist-row-border);
      background: var(--assist-row-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      box-sizing: border-box;
      margin-inline: auto;
    }

    .shortcut-label {
      color: var(--assist-muted);
      font-size: 13px;
      line-height: 1.2;
      letter-spacing: 0.01em;
      text-align: left;
      max-width: calc(100% - 46px);
    }

    .shortcut-key {
      min-width: 34px;
      height: 30px;
      padding: 0 7px;
      border-radius: 6px;
      border: 1px solid var(--assist-key-border);
      background: var(--assist-key-bg);
      color: var(--assist-fg);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      line-height: 1;
      letter-spacing: 0.02em;
      box-sizing: border-box;
      text-align: center;
    }

    .shortcut-action {
      appearance: none;
      font: inherit;
      text-align: left;
      cursor: pointer;
      transition: background 200ms ease, border-color 200ms ease, transform 200ms ease;
    }

    .shortcut-action.active {
      background: rgba(120, 198, 255, 0.2);
      border-color: var(--ui-ring);
    }

    .hint-toast {
      position: fixed;
      left: 50%;
      bottom: calc(clamp(14px, 4vh, 38px) + 96px);
      transform: translateX(-50%) translateY(8px);
      z-index: 9;
      padding: 12px 32px;
      border-radius: 999px;
      border: 1px solid var(--ui-hairline);
      background: rgba(26, 34, 40, 0.44);
      color: rgba(214, 230, 245, 0.62);
      font-size: 20px;
      letter-spacing: 0.01em;
      backdrop-filter: blur(12px) saturate(140%);
      -webkit-backdrop-filter: blur(12px) saturate(140%);
      opacity: 0;
      visibility: hidden;
      transition:
        opacity 900ms ease,
        transform 900ms ease,
        visibility 0s linear 900ms;
      pointer-events: none;
    }

    .hint-toast.visible {
      opacity: 0.82;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
      transition:
        opacity 1800ms ease,
        transform 1800ms ease,
        visibility 0s linear 0s;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    @media (hover: hover) and (pointer: fine) {
      .swatch:hover {
        transform: translateY(-5px) scale(1.04);
        box-shadow:
          inset 0 1px 0 rgba(255, 255, 255, 0.22),
          inset 0 -10px 20px rgba(0, 0, 0, 0.18),
          0 16px 26px rgba(0, 0, 0, 0.34);
        border-color: rgba(255, 255, 255, 0.4);
      }

      .help-ghost:hover {
        opacity: 1;
        color: var(--assist-fg);
        transform: translateY(-1px);
      }

      .apply-btn:hover {
        filter: brightness(1.08);
      }

      .shortcut-action:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.26);
        transform: translateY(-1px);
      }
    }

    .swatch:active {
      transform: translateY(-1px) scale(1.01);
    }

    .apply-btn:active {
      transform: translateY(1px);
    }

    .shortcut-action:active {
      transform: translateY(0);
    }

    @media (max-width: 540px) {
      .dock {
        gap: 10px;
        padding: 10px 11px;
      }

      .swatch {
        width: 56px;
        height: 56px;
        border-radius: 18px;
      }

      .swatch::after {
        border-radius: 16px;
      }

      .custom-form input {
        font-size: 16px;
      }

      .hint-toast {
        font-size: 16px;
        padding: 9px 18px;
      }

      .help-card {
        right: 10px;
        bottom: 50px;
        width: min(94vw, 242px);
      }

      .help-ghost {
        right: 10px;
        bottom: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="controls" aria-hidden="true">
    <div class="dock-wrap" role="dialog" aria-label="Color controls">
      <div class="dock" role="group" aria-label="Color choices">
        <button class="swatch swatch-black" type="button" data-color="black" aria-label="Black">
          <span class="visually-hidden">Black</span>
        </button>
        <button class="swatch swatch-white" type="button" data-color="white" aria-label="White">
          <span class="visually-hidden">White</span>
        </button>
        <button class="swatch swatch-red" type="button" data-color="red" aria-label="Red">
          <span class="visually-hidden">Red</span>
        </button>
        <button class="swatch swatch-custom" id="customToggle" type="button" aria-label="Custom color" aria-controls="customForm" aria-expanded="false">
          <span>+</span>
        </button>
      </div>
      <form id="customForm" class="custom-form" novalidate aria-hidden="true">
        <span id="colorDot" class="color-dot" aria-hidden="true"></span>
        <label class="visually-hidden" for="colorInput">Custom color</label>
        <input id="colorInput" type="text" autocomplete="off" spellcheck="false" placeholder="Any CSS color" aria-describedby="error">
        <button id="applyBtn" class="apply-btn" type="submit" aria-label="Apply color">></button>
      </form>
      <div id="error" role="status" aria-live="polite"></div>
    </div>
  </div>

  <button id="helpGhost" class="help-ghost" type="button" aria-label="Show shortcuts" aria-controls="helpCard" aria-expanded="false">?</button>

  <div id="helpCard" class="help-card" role="dialog" aria-hidden="true" aria-label="Shortcuts and options">
    <div class="keys">
      <div class="shortcut"><span class="shortcut-label">Black</span><span class="shortcut-key">B</span></div>
      <div class="shortcut"><span class="shortcut-label">White</span><span class="shortcut-key">W</span></div>
      <div class="shortcut"><span class="shortcut-label">Red</span><span class="shortcut-key">R</span></div>
      <div class="shortcut"><span class="shortcut-label">Custom</span><span class="shortcut-key">C</span></div>
      <div class="shortcut"><span class="shortcut-label">Fullscreen</span><span class="shortcut-key">F</span></div>
      <div class="shortcut"><span class="shortcut-label">Hide</span><span class="shortcut-key">Esc</span></div>
      <button id="pinToggle" class="shortcut shortcut-action" type="button" aria-pressed="false">
        <span id="pinLabel" class="shortcut-label">Pin controls</span>
        <span class="shortcut-key">P</span>
      </button>
    </div>
    <div class="help-credit">Created by <a href="https://x.com/tavlean" target="_blank" rel="noopener noreferrer">Tavlean</a></div>
  </div>

  <div id="hintToast" class="hint-toast" aria-live="polite">Click anywhere for controls</div>

  <script>
    (function () {
      var controls = document.getElementById("controls");
      var panel = controls.querySelector(".dock-wrap");
      var customForm = document.getElementById("customForm");
      var customToggle = document.getElementById("customToggle");
      var colorDot = document.getElementById("colorDot");
      var input = document.getElementById("colorInput");
      var errorEl = document.getElementById("error");
      var presetButtons = controls.querySelectorAll("[data-color]");
      var helpGhost = document.getElementById("helpGhost");
      var helpCard = document.getElementById("helpCard");
      var pinToggle = document.getElementById("pinToggle");
      var pinLabel = document.getElementById("pinLabel");
      var hintToast = document.getElementById("hintToast");

      var PRESETS = ["black", "white", "red"];
      var currentColor = "black";
      var panelVisible = false;
      var customVisible = false;
      var helpVisible = false;
      var controlsPinned = false;
      var hideTimer = null;
      var errorTimer = null;
      var hintTimer = null;
      var hintDelayTimer = null;
      var hoverHintsEnabled = !!(window.matchMedia && window.matchMedia("(hover: hover) and (pointer: fine)").matches);
      var hintShownFromHover = false;
      var HOVER_HINT_DELAY_MS = 1500;
      var HIDE_DELAY_MS = 5000;

      function parseRgb(text) {
        var parts = text && text.match(/[\d.]+/g);
        if (!parts || parts.length < 3) {
          return null;
        }
        return {
          r: Math.max(0, Math.min(255, parseFloat(parts[0]))),
          g: Math.max(0, Math.min(255, parseFloat(parts[1]))),
          b: Math.max(0, Math.min(255, parseFloat(parts[2])))
        };
      }

      function updateUiTone() {
        var rgb = parseRgb(getComputedStyle(document.body).backgroundColor);
        if (!rgb) {
          return;
        }
        var luminance = (0.2126 * rgb.r + 0.7152 * rgb.g + 0.0722 * rgb.b) / 255;
        var lightBg = luminance > 0.62;
        document.body.classList.toggle("ui-light", lightBg);
      }

      function setActiveSwatch(source) {
        presetButtons.forEach(function (button) {
          var isActive = button.getAttribute("data-color") === source;
          button.classList.toggle("is-active", isActive);
          button.setAttribute("aria-pressed", isActive ? "true" : "false");
        });
        var customActive = source === "custom";
        customToggle.classList.toggle("is-active", customActive);
        customToggle.setAttribute("aria-pressed", customActive ? "true" : "false");
      }

      function setColor(color, source) {
        currentColor = color;
        document.body.style.backgroundColor = color;
        colorDot.style.background = color;
        updateUiTone();

        if (source === "custom") {
          customToggle.style.setProperty("--custom-preview", color);
          setActiveSwatch("custom");
          return;
        }

        if (PRESETS.indexOf(source) !== -1) {
          setActiveSwatch(source);
          return;
        }

        setActiveSwatch("custom");
      }

      function clearError() {
        clearTimeout(errorTimer);
        errorEl.classList.remove("visible");
        errorEl.textContent = "";
      }

      function hideHint() {
        clearTimeout(hintDelayTimer);
        hintDelayTimer = null;
        clearTimeout(hintTimer);
        hintToast.classList.remove("visible");
      }

      function showHint() {
        if (!hoverHintsEnabled) {
          return;
        }
        hintToast.classList.add("visible");
        hintTimer = setTimeout(hideHint, 4800);
      }

      function shouldPauseAutoHide() {
        var active = document.activeElement;
        var hasControlFocus = active && controls.contains(active);
        var helpFocused = active && helpCard.contains(active);
        return controlsPinned ||
          panel.matches(":hover") ||
          hasControlFocus ||
          (helpVisible && (helpCard.matches(":hover") || helpFocused));
      }

      function resetHideTimer() {
        clearTimeout(hideTimer);
        if (!panelVisible || controlsPinned) {
          return;
        }
        hideTimer = setTimeout(function () {
          if (shouldPauseAutoHide()) {
            resetHideTimer();
            return;
          }
          hidePanel();
        }, HIDE_DELAY_MS);
      }

      function setCustomVisible(visible, focusInput) {
        customVisible = visible;
        customForm.classList.toggle("open", visible);
        customForm.setAttribute("aria-hidden", String(!visible));
        customToggle.setAttribute("aria-expanded", visible ? "true" : "false");
        if (!visible) {
          input.blur();
          clearError();
          return;
        }
        if (focusInput) {
          input.focus();
          input.select();
        }
      }

      function setHelpVisible(visible) {
        helpVisible = visible;
        helpCard.classList.toggle("open", visible);
        helpCard.setAttribute("aria-hidden", String(!visible));
        helpGhost.classList.toggle("active", visible);
        helpGhost.setAttribute("aria-expanded", visible ? "true" : "false");
        helpGhost.setAttribute("aria-label", visible ? "Hide shortcuts" : "Show shortcuts");
      }

      function updatePinUi() {
        pinToggle.classList.toggle("active", controlsPinned);
        pinToggle.setAttribute("aria-pressed", controlsPinned ? "true" : "false");
        pinLabel.textContent = controlsPinned ? "Pinned controls" : "Pin controls";
      }

      function showPanel(focusInput) {
        hideHint();
        if (!panelVisible) {
          panelVisible = true;
          controls.classList.add("visible");
          controls.setAttribute("aria-hidden", "false");
        }
        if (focusInput) {
          setCustomVisible(true, true);
        }
        resetHideTimer();
      }

      function hidePanel() {
        clearTimeout(hideTimer);
        panelVisible = false;
        controls.classList.remove("visible");
        controls.setAttribute("aria-hidden", "true");
        setCustomVisible(false, false);
      }

      function finalizeColorSelection() {
        if (controlsPinned) {
          setCustomVisible(false, false);
          resetHideTimer();
          return;
        }
        hidePanel();
      }

      function showError(message) {
        clearTimeout(errorTimer);
        errorEl.textContent = message;
        errorEl.classList.add("visible");
        errorTimer = setTimeout(function () {
          errorEl.classList.remove("visible");
          errorEl.textContent = "";
        }, 1300);
      }

      function tryApplyCustomColor() {
        var value = input.value.trim();
        if (!value) {
          showError("Invalid color");
          setCustomVisible(true, true);
          resetHideTimer();
          return;
        }

        if (window.CSS && CSS.supports && CSS.supports("color", value)) {
          setColor(value, "custom");
          finalizeColorSelection();
          return;
        }

        showError("Invalid color");
        setCustomVisible(true, true);
        resetHideTimer();
      }

      function toggleFullscreen() {
        try {
          if (!document.fullscreenElement && document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
          } else if (document.fullscreenElement && document.exitFullscreen) {
            document.exitFullscreen();
          }
        } catch (_err) {
        }
      }

      presetButtons.forEach(function (button) {
        button.addEventListener("click", function (event) {
          event.stopPropagation();
          setColor(button.getAttribute("data-color"), button.getAttribute("data-color"));
          finalizeColorSelection();
        });
      });

      customToggle.addEventListener("click", function (event) {
        event.stopPropagation();
        showPanel(false);
        setCustomVisible(!customVisible, !customVisible);
        resetHideTimer();
      });

      customForm.addEventListener("submit", function (event) {
        event.preventDefault();
        tryApplyCustomColor();
      });

      input.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          event.preventDefault();
          hidePanel();
          return;
        }
        resetHideTimer();
      });

      input.addEventListener("input", function () {
        clearError();
        resetHideTimer();
      });

      controls.addEventListener("focusin", function () {
        resetHideTimer();
      });

      panel.addEventListener("pointerdown", function (event) {
        event.stopPropagation();
        resetHideTimer();
      });

      panel.addEventListener("pointermove", function () {
        resetHideTimer();
      });

      panel.addEventListener("pointerleave", function () {
        resetHideTimer();
      });

      helpGhost.addEventListener("pointerdown", function (event) {
        event.stopPropagation();
      });

      helpCard.addEventListener("pointerdown", function (event) {
        event.stopPropagation();
      });

      helpGhost.addEventListener("click", function () {
        hideHint();
        setHelpVisible(!helpVisible);
      });

      pinToggle.addEventListener("click", function () {
        controlsPinned = !controlsPinned;
        updatePinUi();
        if (controlsPinned) {
          showPanel(false);
        } else {
          resetHideTimer();
        }
      });

      document.addEventListener("pointerdown", function (event) {
        hideHint();
        if (helpVisible && !helpCard.contains(event.target) && event.target !== helpGhost) {
          setHelpVisible(false);
          return;
        }
        if (helpCard.contains(event.target) || event.target === helpGhost) {
          return;
        }
        if (panel.contains(event.target)) {
          return;
        }
        showPanel(false);
      });

      document.addEventListener("pointermove", function (event) {
        if (!hoverHintsEnabled || hintShownFromHover || panelVisible || helpVisible || hintDelayTimer) {
          return;
        }
        if (event.pointerType && event.pointerType !== "mouse") {
          return;
        }
        hintDelayTimer = setTimeout(function () {
          hintDelayTimer = null;
          if (panelVisible || helpVisible || hintShownFromHover) {
            return;
          }
          hintShownFromHover = true;
          showHint();
        }, HOVER_HINT_DELAY_MS);
      });

      document.addEventListener("keydown", function (event) {
        var key = event.key;
        var active = document.activeElement;
        var typingInCustom = !!(active && customForm.contains(active));
        hideHint();

        if (key === "Escape") {
          if (helpVisible) {
            setHelpVisible(false);
            return;
          }
          hidePanel();
          return;
        }

        if (typingInCustom) {
          return;
        }

        if (key === "?" || (key === "/" && event.shiftKey)) {
          event.preventDefault();
          setHelpVisible(!helpVisible);
          return;
        }

        if (key === "b" || key === "B") {
          setColor("black", "black");
          if (panelVisible) {
            finalizeColorSelection();
          }
          return;
        }
        if (key === "w" || key === "W") {
          setColor("white", "white");
          if (panelVisible) {
            finalizeColorSelection();
          }
          return;
        }
        if (key === "r" || key === "R") {
          setColor("red", "red");
          if (panelVisible) {
            finalizeColorSelection();
          }
          return;
        }
        if (key === "c" || key === "C") {
          event.preventDefault();
          showPanel(true);
          return;
        }
        if (key === "f" || key === "F") {
          event.preventDefault();
          toggleFullscreen();
          return;
        }
        if (key === "p" || key === "P") {
          event.preventDefault();
          controlsPinned = !controlsPinned;
          updatePinUi();
          if (controlsPinned) {
            showPanel(false);
          } else {
            resetHideTimer();
          }
          return;
        }
        if (
          key === "Enter" ||
          key === "NumpadEnter" ||
          key === "OK" ||
          key === "Select"
        ) {
          if (document.activeElement === input) {
            return;
          }
          event.preventDefault();
          showPanel(true);
        }
      });

      updatePinUi();
      setColor(currentColor, "black");
      setCustomVisible(false, false);
      setHelpVisible(false);
    })();
  </script>
</body>
</html>
